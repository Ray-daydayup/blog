<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./css/base.css">
  <link rel="stylesheet" href="./css/grid.css">
  <link rel="stylesheet" href="./css/iconfont.css">
  <script src="./js/rem.js"></script>
</head>

<body>
  <header class="common-header">
    <div class="container height-100 clearfix">
      <div class="row">
        <div class="col-2 logo">
          <a href="./index.html">
            <img src="./images/logo362x82.png" alt="">
          </a>
        </div>
        <nav class="col-10 menu">
          <div class="visible-lg clearfix">
            <div class="menu-left fl">
              <!-- <a href="#">首页</a>
              <a href="#">归档</a>
              <a href="#">标签</a>
              <a href="#">分类</a>
              <a href="#">关于</a> -->
            </div>
            <div class="menu-right fr">
              <!-- <a href="#"><i class="iconfont icon-github-fill"></i></a>
              <a href="#"><i class="iconfont icon-search"></i></a> -->
            </div>
          </div>
          <div class="hidden-lg menu-not-lg">
            <!-- <a href="#">首页</a>
            <a href="#">归档</a>
            <a href="#">标签</a>
            <a href="#">分类</a>
            <a href="#">关于</a>
            <a href="#"><i class="iconfont icon-github-fill"></i></a>
            <a href="#"><i class="iconfont icon-search"></i></a> -->
          </div>
        </nav>
      </div>
    </div>
  </header>

  <script src="./js/element.js"></script>
  <script>
    var str1 =
      `a[href=#]{首页}+a[href=#]{归档}+a[href=#]{标签}+a[href=#]{分类}+a[href=#]{关于}`
    var str2 =
      `(a[href=#]>i[class=iconfont icon-github-fill])+(a[href=#]>i[class=iconfont icon-search])`
    /** 
     * 符号含义: '>' 父子关系  '+' 兄弟关系  '[]' 属性  '{}' 文本  '()'优先运算
     * 符号优先级：'()'大于 '>' 等于 '+' 大于 '[]' 等于 '{}'
     * 解析思路 ：从左到右解析
     *          - 任何符号之间的纯字母都是标签名  
     *          - '()'解析的函数
     *          - '[]'解析的函数
     *          - '{}'解析的函数
     */
    generateDomObj(ast(str1)).forEach(item => {
      element.appendChild(".common-header nav .menu-left", item);
      element.appendChild(".common-header nav .menu-not-lg", item);
    })
    generateDomObj(ast(str2)).forEach(item => {
      element.appendChild(".common-header nav .menu-right", item);
      element.appendChild(".common-header nav .menu-not-lg", item);
    })

    function generateDomObj(astArr) {
      const result = [];
      const head = [];
      let currentLevel = 0;
      let pointer = result;
      head.push(pointer);
      astArr.forEach((item, index) => {
        if (item.level > currentLevel) {
          currentLevel = item.level;
          astArr[index - 1].children = [];
          pointer = astArr[index - 1].children;
          head.push(pointer);
        }
        if (item.level < currentLevel) {
          currentLevel = item.level;
          pointer = head[currentLevel];
          head.splice(currentLevel + 1, Infinity)
        }
        pointer.push(item);
      })
      return result
    }

    function ast(str) {
      let startLevel = 0;
      // str = str.replace(/[\r\n]/g, "");
      const stack = [];
      return match(str, '', startLevel)

      function match(str, lastCharacter, startLevel) {
        let level = startLevel;
        const result = [];
        var tagName = '';
        var prop = {};
        var textNode = '';
        do {
          if (str[0] === "+") {
            lastCharacter = str[0];
            str = str.replace('+', "");
          }
          if (str[0] === ">") {
            lastCharacter = str[0];
            str = str.replace('>', "");
            level++;
          }
          if (str[0] === "(") {
            // if (str[0] === lastCharacter) {
            //   level++
            // }
            lastCharacter = str[0];
            str = str.replace('(', "");
            stack.push(level);
          }
          if (str[0] === ")") {
            // if (str[0] === lastCharacter) {
            //   level--
            // }
            lastCharacter = str[0];
            str = str.replace(')', "");
            level = stack.pop();
          }
          if (/\w/.test(str[0]) && str !== '') {
            lastCharacter = str[0];
            tagName = str.match(/\w+/)[0];
            str = str.replace(/\w+/, "");
          }
          if (str[0] === "{") {
            lastCharacter = str[0];
            textNode = str.match(/\{(.+?)\}/)[1];
            str = str.replace(/\{(.+?)\}/, "");
          }
          if (str[0] === "[") {
            lastCharacter = str[0];
            let arr = str.match(/\[(.+?)\]/)[1].split(',');
            arr.forEach(item => {
              let tempArr = item.split('=');
              prop[tempArr[0]] = tempArr[1];
            })
            str = str.replace(/\[(.+?)\]/, "");
          }
        } while (str !== "" && str[0] !== ">" && str[0] !== "+" && str[0] !== ")");
        if (tagName !== '') {
          result.push({
            level,
            tagName,
            prop,
            textNode
          })
        }
        if (str === "") {
          return result
        } else {
          let tempArr = match(str, lastCharacter, level);
          result.push(...tempArr)
        }
        return result
      }
    }

    // var map = {
    //   "(": ")"
    // };
    // var stack = [];
    // var
    // for (let i = 0; i < str.length; i++) {
    //   if (str[i] === "(") {
    //     stack.push(i);
    //   } else if (str[i] === ")") {
    //     [stack.length, stack.pop(), i]
    //   }
    // }
    // var regex1 = /\((.+?)\)/; // () 小括号
    // var regex2 = /\[(.+?)\]/; // [] 中括号
    // var regex3 = /\{(.+?)\}/; // {} 花括号，大括号
    // var regex4 = /\w+/; // 
    // console.log(str.replace(/\[(.+?)\]/g, '').replace(/\{(.+?)\}/, ''));
    // console.log(str);
    // 输出是一个数组
    // console.log(str.match(regex1));
    // console.log(str.match(regex1)[0].match(regex1));
    // console.log(str.match(regex2));
    // console.log(str.match(regex3));
    // console.log(str.match(regex4));
    // console.log(str.match(regex4));
    // console.log(str.match(regex4));
  </script>
</body>

</html>